services:
  # Flask Backend + Telegram Bot (Web Service)
  - type: web
    name: felix-hub-backend
    env: python
    pythonVersion: "3.11.9"
    region: frankfurt
    plan: free
    branch: main
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn -w 1 -b 0.0.0.0:$PORT --timeout 120 felix_hub.backend.app:app"
    healthCheckPath: /health
    autoDeploy: true
    envVars:
      - key: WEBHOOK_URL
        value: https://felix-hub-backend.onrender.com
      - key: ALLOWED_ORIGINS
        value: https://felix-hub-mechanics-frontend.onrender.com,http://localhost:3000,http://localhost:5173

  # Mechanics Frontend (Static Site)
  - type: web
    name: felix-hub-mechanics-frontend
    env: static
    region: frankfurt
    plan: free
    branch: main
    buildCommand: "cd felix_hub/frontend && npm ci && npm run build"
    staticPublishPath: felix_hub/frontend/dist
    autoDeploy: true
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VITE_API_URL
        value: https://felix-hub-backend.onrender.com/api

databases:
  # PostgreSQL Database
  - name: felix-hub-db
    databaseName: felix_hub
    plan: free
    region: frankfurt
