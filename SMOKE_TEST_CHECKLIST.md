# Smoke Test Checklist - Felix Hub Mechanics Frontend

Используйте этот чеклист для проверки prod-версии после деплоя на Render.

## Pre-Test Setup

- [ ] Backend доступен: https://felix-hub-backend.onrender.com/health
- [ ] Frontend доступен: https://felix-hub-mechanics-frontend.onrender.com
- [ ] Есть тестовые credentials механика для входа
- [ ] Browser DevTools открыты (Console + Network tabs)

## 1. Login Page (`/mechanic/login`)

### Функциональность
- [ ] Страница загружается без ошибок
- [ ] Форма входа отображается корректно
- [ ] Placeholder'ы и labels на русском языке
- [ ] Email валидация работает (неверный формат показывает ошибку)
- [ ] Password валидация работает (< 6 символов показывает ошибку)

### Успешный вход
- [ ] Ввести корректные credentials
- [ ] Нажать "Войти"
- [ ] Toast "Вход выполнен успешно" появляется
- [ ] Редирект на `/mechanic/dashboard`
- [ ] В localStorage есть `mechanic_token`
- [ ] В localStorage есть `mechanic` (JSON объект)

### Ошибки входа
- [ ] Ввести неверный email/password
- [ ] Toast с ошибкой появляется
- [ ] Редирект НЕ происходит
- [ ] Token НЕ сохраняется в localStorage

### Deeplink Login (если применимо)
- [ ] URL вида `/mechanic/login?token=XXX` автоматически входит
- [ ] URL вида `/mechanic/login?token=XXX&order=123` входит и перенаправляет на заказ

### Network & Console
- [ ] POST `/api/mechanic/login` возвращает 200
- [ ] Response содержит `token` и `mechanic`
- [ ] Нет CORS ошибок
- [ ] Нет JavaScript ошибок

---

## 2. Dashboard (`/mechanic/dashboard`)

### Загрузка
- [ ] Статистика загружается (3 карточки вверху)
- [ ] Список заказов загружается
- [ ] Loading состояние показывается во время загрузки
- [ ] Нет ошибок в консоли

### Статистика (3 карточки)
- [ ] "В работе" - показывает число активных заказов
- [ ] "Сегодня" - показывает завершенные сегодня заказы
- [ ] "Времени" - показывает часы работы сегодня

### Фильтры
- [ ] Табы отображаются: Все, Новые, В работе, Готовые
- [ ] Клик на "Новые" фильтрует список
- [ ] Клик на "В работе" фильтрует список
- [ ] Клик на "Готовые" фильтрует список
- [ ] Клик на "Все" показывает все заказы
- [ ] URL параметр `?status=XXX` передается в API

### Список заказов
- [ ] Каждая карточка показывает: номер заказа, VIN, категорию, запчасть
- [ ] Badge со статусом правильного цвета
- [ ] Время создания в формате DD.MM.YYYY HH:MM
- [ ] Если есть total_time_minutes, показывается иконка часов

### Навигация
- [ ] Клик на карточку заказа переходит в `/mechanic/orders/:id`
- [ ] Bottom navigation на мобильных (Заказы, Время, Профиль)
- [ ] Header показывает имя механика
- [ ] Кнопка Logout в header

### Network & Console
- [ ] GET `/api/mechanic/stats` возвращает 200
- [ ] GET `/api/mechanic/orders` возвращает 200 (возможно с ?status=XXX)
- [ ] Authorization header с Bearer токеном присутствует
- [ ] Нет CORS ошибок
- [ ] Нет JavaScript ошибок

---

## 3. Order Details (`/mechanic/orders/:id`)

### Загрузка
- [ ] Информация о заказе загружается
- [ ] Header показывает номер заказа и статус
- [ ] Кнопка "Назад" в header
- [ ] Кнопка звонка клиенту (если есть phone)

### Информация о заказе
- [ ] Клиент (mechanic_name)
- [ ] VIN
- [ ] Категория
- [ ] Тип запчасти
- [ ] Фото (если есть photo_url)

### Управление статусом
- [ ] Кнопки смены статуса отображаются
- [ ] Доступны статусы: Новый, В работе, На паузе, Завершен
- [ ] Клик меняет статус
- [ ] Toast "Статус обновлен" появляется
- [ ] UI обновляется с новым статусом

### Вкладка "Детали"
- [ ] Показывает основную запчасть
- [ ] Показывает фото (если есть)
- [ ] Показывает дополнительные работы (если есть custom_works)
- [ ] Показывает дополнительные запчасти (если есть custom_parts)

### Вкладка "Время"
- [ ] Карточка "Текущая работа" отображается
- [ ] Если таймер неактивен: кнопка "Начать работу"
- [ ] Клик на "Начать работу" запускает таймер
- [ ] Таймер обновляется каждую секунду
- [ ] Поле для заметок доступно
- [ ] Кнопка "Остановить" останавливает таймер
- [ ] Toast "Время сохранено" появляется
- [ ] Сессия добавляется в историю
- [ ] История времени показывает все сессии
- [ ] Кнопка "Добавить вручную" открывает модальное окно
- [ ] Ручное добавление времени работает (datetime-local inputs)
- [ ] Валидация: end_time > start_time

### Вкладка "Комментарии"
- [ ] Список комментариев отображается
- [ ] Форма добавления комментария
- [ ] Textarea для ввода комментария
- [ ] Кнопка "Добавить"
- [ ] Новый комментарий добавляется в список
- [ ] Toast "Комментарий добавлен"
- [ ] Счетчик комментариев в табе обновляется

### Вкладка "+" (Кастомные позиции)
- [ ] Два блока: Дополнительные работы, Дополнительные запчасти
- [ ] Форма добавления работы:
  - [ ] Название (обязательно)
  - [ ] Описание
  - [ ] Цена (обязательно, number)
  - [ ] Время (обязательно, number)
  - [ ] Кнопка "Добавить работу"
- [ ] Форма добавления запчасти:
  - [ ] Название (обязательно)
  - [ ] Номер запчасти
  - [ ] Цена (обязательно, number)
  - [ ] Количество (обязательно, number, default 1)
  - [ ] Кнопка "Добавить запчасть"
- [ ] После добавления: toast success и обновление списка

### Network & Console
- [ ] GET `/api/mechanic/orders/:id` возвращает 200
- [ ] PATCH `/api/mechanic/orders/:id/status` возвращает 200
- [ ] POST `/api/mechanic/orders/:id/time/start` возвращает 200
- [ ] POST `/api/mechanic/orders/:id/time/stop` возвращает 200
- [ ] POST `/api/mechanic/orders/:id/time/manual` возвращает 200
- [ ] POST `/api/mechanic/orders/:id/comments` возвращает 201
- [ ] POST `/api/mechanic/orders/:id/custom-work` возвращает 201
- [ ] POST `/api/mechanic/orders/:id/custom-part` возвращает 201
- [ ] Нет CORS ошибок
- [ ] Нет JavaScript ошибок

---

## 4. Time History (`/mechanic/time`)

### Загрузка
- [ ] Заголовок "История рабочего времени"
- [ ] 4 карточки статистики вверху
- [ ] Фильтры периода отображаются

### Статистика (4 карточки)
- [ ] Всего времени (часы и минуты)
- [ ] Сессий (количество)
- [ ] Средняя сессия (время)
- [ ] Заказов (количество)

### Фильтры периода
- [ ] Табы: Сегодня, Вчера, Неделя, Месяц, Выбрать
- [ ] "Сегодня" - показывает сегодняшние сессии
- [ ] "Вчера" - показывает вчерашние сессии
- [ ] "Неделя" - показывает текущую неделю
- [ ] "Месяц" - показывает текущий месяц
- [ ] "Выбрать" - показывает date inputs
  - [ ] Input "Дата начала"
  - [ ] Input "Дата окончания"
  - [ ] Кнопка "Применить"
  - [ ] После клика загружаются данные за выбранный период

### Группировка по дням
- [ ] Сессии сгруппированы по дням
- [ ] Заголовок дня: "Сегодня", "Вчера", или "DD месяц YYYY"
- [ ] Badge с общим временем дня
- [ ] Сессии внутри дня отсортированы по времени

### Каждая сессия
- [ ] Время начала - время окончания (HH:MM - HH:MM)
- [ ] Номер заказа
- [ ] Длительность в минутах/часах
- [ ] Заметки (если есть)
- [ ] Кнопка перехода в заказ (ExternalLink icon)

### Навигация
- [ ] Клик на кнопку ExternalLink переходит в `/mechanic/orders/:id`

### Network & Console
- [ ] GET `/api/mechanic/time/history?start_date=XXX&end_date=XXX` возвращает 200
- [ ] Response содержит `stats` и `sessions`
- [ ] Нет CORS ошибок
- [ ] Нет JavaScript ошибок

---

## 5. Profile (`/mechanic/profile`)

### Загрузка
- [ ] Информация о профиле загружается
- [ ] Avatar с инициалами
- [ ] Badge "Активен" или "Неактивен"

### Информация о профиле
- [ ] Имя механика
- [ ] Email (не редактируется)
- [ ] Телефон (редактируется)
- [ ] Специализация (если есть)
- [ ] Дата регистрации

### Редактирование профиля
- [ ] Кнопка "Редактировать"
- [ ] Клик открывает режим редактирования
- [ ] Поле телефона становится input
- [ ] Кнопки "Сохранить" и "Отмена" появляются
- [ ] Ввод нового телефона
- [ ] Клик "Сохранить":
  - [ ] Toast "Профиль обновлён"
  - [ ] Данные обновляются в UI
  - [ ] localStorage обновляется
- [ ] Клик "Отмена" возвращает старое значение

### Смена пароля
- [ ] Форма смены пароля отображается
- [ ] 3 поля: Текущий пароль, Новый пароль, Подтвердите пароль
- [ ] Валидация: минимум 6 символов для нового пароля
- [ ] Валидация: new_password === confirm_password
- [ ] Кнопка "Сменить пароль"
- [ ] После успешной смены:
  - [ ] Toast "Пароль успешно изменён"
  - [ ] Форма очищается
- [ ] При ошибке (неверный текущий пароль):
  - [ ] Toast с ошибкой

### Общая статистика
- [ ] 4 карточки со статистикой:
  - [ ] Всего отработано (часы)
  - [ ] Завершено заказов
  - [ ] Среднее время заказа
  - [ ] В работе (активные)

### Выход
- [ ] Кнопка "Выйти из аккаунта"
- [ ] Клик показывает confirm диалог
- [ ] После подтверждения:
  - [ ] localStorage очищается (`mechanic_token`, `mechanic`)
  - [ ] Редирект на `/mechanic/login`

### Network & Console
- [ ] GET `/api/mechanic/me` возвращает 200
- [ ] GET `/api/mechanic/stats?all_time=true` возвращает 200
- [ ] PATCH `/api/mechanic/profile` возвращает 200
- [ ] POST `/api/mechanic/change-password` возвращает 200
- [ ] Нет CORS ошибок
- [ ] Нет JavaScript ошибок

---

## 6. Cross-Page Functionality

### Navigation & Routing
- [ ] Browser back button работает
- [ ] Browser forward button работает
- [ ] Direct URL navigation работает (копировать URL и вставить в новой вкладке)
- [ ] 404 перенаправляет на login

### Protected Routes
- [ ] Без токена: редирект на `/mechanic/login`
- [ ] С токеном: доступ к защищенным страницам
- [ ] При 401 от API: автоматический logout и редирект на login

### Mobile Navigation (Bottom Nav)
- [ ] Иконки четкие и понятные
- [ ] Touch targets достаточно большие (не нужно "целиться")
- [ ] Active state правильно подсвечивается
- [ ] Переход между страницами работает

### Header
- [ ] На всех страницах одинаковый header
- [ ] Имя механика отображается
- [ ] Кнопка Logout всегда доступна

---

## 7. Network & Console Errors

### Console (открыть DevTools F12)
- [ ] Нет красных ошибок JavaScript
- [ ] Нет CORS ошибок
- [ ] console.error только для реальных ошибок (не в production коде)
- [ ] Warnings можно игнорировать (если не критичные)

### Network Tab
- [ ] Все запросы к API идут на `https://felix-hub-backend.onrender.com/api`
- [ ] Успешные запросы: 200, 201, 204
- [ ] Ожидаемые ошибки: 400 (bad request), 401 (unauthorized), 404 (not found)
- [ ] Header `Authorization: Bearer <token>` присутствует
- [ ] Header `Content-Type: application/json` на POST/PATCH
- [ ] Response времена: < 2s (с учетом free tier Render может быть медленнее)
- [ ] Нет failed requests (кроме ожидаемых 4xx)

---

## 8. Mobile & Responsive

### Desktop (> 768px)
- [ ] Layout использует максимум 4xl контейнер (max-w-4xl)
- [ ] Bottom navigation скрыта (md:hidden)
- [ ] Все элементы читаемы и не наползают друг на друга

### Tablet (768px - 1024px)
- [ ] Layout адаптируется
- [ ] Touch targets увеличены где нужно

### Mobile (< 768px)
- [ ] Bottom navigation видна
- [ ] Grid переключается на меньшее количество колонок
- [ ] Текст читаем
- [ ] Кнопки достаточно большие (min 44px)
- [ ] Не нужен horizontal scroll

### Touch Interactions
- [ ] Все кнопки реагируют на touch
- [ ] Нет задержек при клике
- [ ] Форма inputs открывают мобильную клавиатуру правильно
- [ ] Date/time inputs работают с нативными пикерами

---

## 9. Performance (Lighthouse Mobile)

### Запуск Lighthouse
1. Открыть DevTools (F12)
2. Перейти на вкладку "Lighthouse"
3. Выбрать "Mobile"
4. Выбрать категории: Performance, Accessibility, Best Practices, SEO
5. Нажать "Analyze page load"

### Целевые показатели
- [ ] **Performance**: ≥ 80
- [ ] **Accessibility**: ≥ 90
- [ ] **Best Practices**: ≥ 90
- [ ] **SEO**: ≥ 80

### Performance метрики (ориентировочно)
- [ ] First Contentful Paint (FCP): < 2s
- [ ] Largest Contentful Paint (LCP): < 3s
- [ ] Time to Interactive (TTI): < 4s
- [ ] Total Blocking Time (TBT): < 300ms
- [ ] Cumulative Layout Shift (CLS): < 0.1

### Если Performance < 80
Проверить:
- [ ] Размер bundle chunks (должны быть < 200KB gzipped)
- [ ] Lazy loading работает (проверить в Network tab)
- [ ] Нет unnecessary re-renders

---

## 10. Final Checks

### General
- [ ] Все тосты показываются в правильном месте (top-center)
- [ ] Тосты автоматически исчезают через 3-5 секунд
- [ ] Loading состояния показываются (spinners, skeletons)
- [ ] Error states обрабатываются (показывают понятные сообщения)
- [ ] Нет "undefined" или "null" в UI

### Data Persistence
- [ ] localStorage сохраняет токен между перезагрузками
- [ ] После logout localStorage очищается
- [ ] После повторного входа данные обновляются

### Images & Assets
- [ ] Все статические файлы загружаются (CSS, JS)
- [ ] Favicon отображается в табе браузера
- [ ] Фото заказов (если есть) загружаются

### PWA
- [ ] Manifest.json загружается (проверить в Network tab)
- [ ] Theme color применяется (цвет верхней панели на мобильном)
- [ ] "Add to Home Screen" работает (опционально)

---

## Summary

**Дата теста**: _________________  
**Протестировано**: _________________  
**Браузер**: _________________  
**Устройство**: _________________  

**Критичные проблемы** (блокируют использование):
1. 
2. 
3. 

**Некритичные проблемы** (можно исправить позже):
1. 
2. 
3. 

**Lighthouse Score**:
- Performance: _____ / 100
- Accessibility: _____ / 100
- Best Practices: _____ / 100
- SEO: _____ / 100

**Общий результат**: ✅ PASS / ❌ FAIL

**Комментарии**:
___________________________________________________________
___________________________________________________________
___________________________________________________________
